buildscript {
    repositories {
        mavenCentral()
    }
}

plugins {
    id "com.bmuschko.docker-remote-api" version "8.0.0"
}

// Import task types
import com.bmuschko.gradle.docker.tasks.image.Dockerfile
import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage
import com.bmuschko.gradle.docker.tasks.image.DockerPushImage

task createDockerfile(type: Dockerfile) {
    from 'busybox'
    addFile("https://github.com/aws-observability/aws-otel-java-instrumentation/releases/download/v1.16.0/aws-opentelemetry-agent.jar", "javaagent.jar")
    runCommand("chmod -R go+r /javaagent.jar")
}

// Use task types
task buildDockerImage(type: DockerBuildImage) {
    dependsOn createDockerfile
    images.add(getTagFromImageName())
}

task pushDockerImage(type: DockerPushImage) {
    dependsOn buildDockerImage
    images = buildDockerImage.images
}

def getTagFromImageName() {
    return 'hub.xenit.eu/customer-oup/aws-otel-java-agent:1.0.1'
}