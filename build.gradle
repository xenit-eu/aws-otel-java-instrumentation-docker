plugins {
    id "eu.xenit.docker" version "5.3.2"
    id "base"
}

repositories {
    mavenCentral()
}

ext {
    version = "1.17.0"
}

def myAttribute = Attribute.of("org.gradle.dependency.bundling", String)

configurations {
    awsOtelAgent {
        attributes {
            attribute(myAttribute, "shadowed")
        }
    }
}

dependencies {
    awsOtelAgent(group: 'software.amazon.opentelemetry', name: 'aws-opentelemetry-agent', version: project.ext.version, ext: 'jar')
    attributesSchema {
        attribute(myAttribute)
    }
}

dockerBuild {
    repositories = ['hub.xenit.eu/customer-oup/aws-otel-java-agent']
}

createDockerFile {
    from 'busybox'
    smartCopy configurations.awsOtelAgent.singleFile, "javaagent.jar"
    runCommand("chmod -R go+r /javaagent.jar")
}

def getTagFromImageName() {
    return 'hub.xenit.eu/customer-oup/aws-otel-java-agent:1.0.1'
}